FROM httpd:2.2

LABEL author="Medicean (Medici.Yan@Gmail.com)"
LABEL maintainer="cved (cved@protonmail.com)"

ENV LANG C.UTF-8
ENV LANGUAGE C.UTF-8
ENV LC_ALL C.UTF-8

ARG DEBIAN_FRONTEND=noninteractive
RUN apt-get -y update \
    && apt-get -y install \
    wget \
    build-essential \
    bison \
    autoconf \
    && apt-get autoremove \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    
RUN mkdir /tmp/bash \
    && cd /tmp/bash \
    && wget -qO- https://ftp.gnu.org/gnu/bash/bash-4.3.tar.gz | tar zx --strip-components=1 \
    && wget -qO- $(seq -f "https://ftp.gnu.org/gnu/bash/bash-4.3-patches/bash43-%03g" 24) | patch -p0 \
    && ./configure \
    && make \
    && make install \
    && rm -rf /tmp/bash \
    && rm /bin/bash \
    && ln -s /usr/local/bin/bash /bin/bash

COPY build/test.cgi /usr/local/apache2/cgi-bin/
RUN chmod a+x /usr/local/apache2/cgi-bin/test.cgi \
    && echo "<a href='/cgi-bin/test.cgi'>test.cgi</a>" > /usr/local/apache2/htdocs/index.html \
    && chmod a+x /usr/local/apache2/htdocs/index.html

EXPOSE 80
